webpackJsonp([19],{

/***/ 741:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "LoginPageModule", function() { return LoginPageModule; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_ionic_angular__ = __webpack_require__(14);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__login__ = __webpack_require__(758);
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};



var LoginPageModule = (function () {
    function LoginPageModule() {
    }
    LoginPageModule = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["NgModule"])({
            declarations: [
                __WEBPACK_IMPORTED_MODULE_2__login__["a" /* LoginPage */],
            ],
            imports: [
                __WEBPACK_IMPORTED_MODULE_1_ionic_angular__["IonicPageModule"].forChild(__WEBPACK_IMPORTED_MODULE_2__login__["a" /* LoginPage */]),
            ],
        })
    ], LoginPageModule);
    return LoginPageModule;
}());

//# sourceMappingURL=login.module.js.map

/***/ }),

/***/ 758:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return LoginPage; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return user_info; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_ionic_angular__ = __webpack_require__(14);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__providers_http_http__ = __webpack_require__(159);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__providers_storage_storage__ = __webpack_require__(88);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__providers_dialog_dialog__ = __webpack_require__(46);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__providers_user_info_user_info__ = __webpack_require__(372);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__providers_service_user_data_service__ = __webpack_require__(375);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__providers_service_order_data_service__ = __webpack_require__(374);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__ionic_native_network__ = __webpack_require__(373);
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};









/**
 * Generated class for the LoginPage page.
 *
 * See https://ionicframework.com/docs/components/#navigation for more info on
 * Ionic pages and navigation.
 */
var LoginPage = (function () {
    function LoginPage(navCtrl, viewCtrl, http, storage, dialog, toastCtrl, user, order, userData, network, modalCtrl) {
        this.navCtrl = navCtrl;
        this.viewCtrl = viewCtrl;
        this.http = http;
        this.storage = storage;
        this.dialog = dialog;
        this.toastCtrl = toastCtrl;
        this.user = user;
        this.order = order;
        this.userData = userData;
        this.network = network;
        this.modalCtrl = modalCtrl;
        /*模型设置*/
        this.loginInfo = {
            UserName: '',
            PassWord: ''
        };
        //登录信息
        this.userInfo = new user_info();
    }
    LoginPage.prototype.openModal = function (characterNum) {
        return __awaiter(this, void 0, void 0, function () {
            var modal;
            return __generator(this, function (_a) {
                modal = this.modalCtrl.create('Login2Page', { characterNum: 1111 });
                modal.onDidDismiss(function (data) {
                    console.log(data);
                });
                modal.present();
                return [2 /*return*/];
            });
        });
    };
    LoginPage.prototype.ionViewDidLoad = function () {
        return __awaiter(this, void 0, void 0, function () {
            var a;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        console.log('ionViewDidLoad LoginPage');
                        return [4 /*yield*/, this.userData.find(function (user) { return user.key !== ''; })];
                    case 1:
                        a = _a.sent();
                        if (a.length > 0) {
                            this.loginInfo.UserName = a[0]['phone'];
                            this.loginInfo.PassWord = a[0]['password'];
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    // 页面跳转的方式
    LoginPage.prototype.register = function () {
        this.navCtrl.push('RegisterPage');
    };
    LoginPage.prototype.forgetpwd = function () {
        this.navCtrl.push('ForgetPwdPage');
    };
    /**
     * 用户登录
     */
    LoginPage.prototype.loginOnSuccess = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            var a, subscriber, silly, params, a, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(this.network.type === 'none')) return [3 /*break*/, 2];
                        this.navCtrl.push('TabsPage');
                        return [4 /*yield*/, this.userData.find(function (user) { return user.key !== ''; })];
                    case 1:
                        a = _a.sent();
                        this.userInfo = a[0];
                        this.user.setuserInfo(this.userInfo);
                        return [2 /*return*/];
                    case 2:
                        subscriber = /^((13[0-9])|(14[5,7,9])|(15[^4])|(18[0-9])|(17[0,1,3,5,6,7,8]))\d{8}$/;
                        silly = subscriber.test(this.loginInfo.UserName);
                        if (this.loginInfo.UserName == '' || this.loginInfo.UserName == null) {
                            // this.dialog.showAlert('警告','手机号不能为空');
                            this.toastCtrl.create({
                                message: '手机号不能为空',
                                duration: 2000,
                                position: 'top'
                            }).present();
                            return [2 /*return*/];
                        }
                        if (this.loginInfo.UserName.length != 11) {
                            // this.dialog.showAlert('警告', '手机号是11位数字');
                            this.toastCtrl.create({
                                message: '手机号是11位数字',
                                duration: 2000,
                                position: 'top'
                            }).present();
                            return [2 /*return*/];
                        }
                        if (!silly) {
                            // this.dialog.showAlert('警告', '手机号不合法');
                            this.toastCtrl.create({
                                message: '手机号不合法',
                                duration: 2000,
                                position: 'top'
                            }).present();
                            return [2 /*return*/];
                        }
                        if (this.loginInfo.PassWord == '' || this.loginInfo.PassWord == null) {
                            // this.dialog.showAlert('警告', '密码不能为空');
                            this.toastCtrl.create({
                                message: '密码不能为空',
                                duration: 2000,
                                position: 'top'
                            }).present();
                            return [2 /*return*/];
                        }
                        params = {
                            username: this.loginInfo.UserName,
                            password: this.loginInfo.PassWord
                        };
                        if (!(this.network.type === 'none')) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.userData.find(function (user) { return (user.key !== ''); })];
                    case 3:
                        a = _a.sent();
                        console.log(a);
                        if (a[0].password === params.password && a[0].phone === params.username) {
                            this.navCtrl.push('TabsPage');
                        }
                        else {
                            this.dialog.showToast('提示', '当前无网络只能登陆上一次登陆的用户');
                        }
                        return [2 /*return*/];
                    case 4: return [4 /*yield*/, this.http.postJson('', 'users/member/login', { 'phone': params.username, 'password': params.password }, '')
                            .then(function (res) {
                            if (res['status'] == 200) {
                                //this.dialog.showAlert('您好'+res['data']['nickname'], res['message']);		
                                res['data']['password'] = params.password;
                                // this.storage.saveStorage("login_info", res['data']);
                                _this.userInfo = res['data'];
                                _this.user.setuserInfo(_this.userInfo);
                                _this.userData.deleteAll();
                                _this.userData.save(_this.userInfo);
                                _this.http.setAuthorization(res['data']['access_token']); //该令牌唯一表示该用户、用户的组和用户的特权。系统使用令牌控制用户可以访问哪些安全对象，并控制用户执行相关系统操作的能力
                                _this.getdictionary();
                                _this.navCtrl.push('TabsPage');
                            }
                            else {
                                _this.toastCtrl.create({
                                    message: res['message'],
                                    duration: 2000,
                                    position: 'top'
                                }).present();
                            }
                        })];
                    case 5:
                        res = _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    LoginPage.prototype.getdictionary = function () {
        var _this = this;
        this.http.postJson('', 'aindex/dictionary/index', {
            select: "m.D_GROUP",
            joinWith: "group", "groupby": "D_GROUP", "indexBy": "D_GROUP", "limit": 0,
            where: ["<>", "s_dictionary.D_STATE", 0]
        }, '')
            .then(function (res) {
            if (res['status'] == 200) {
                _this.storage.saveStorage("dictionary", JSON.stringify(res['data']));
            }
        });
    };
    LoginPage.prototype.eliminate = function (UserName) {
        this.loginInfo.PassWord = '';
    };
    LoginPage = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Component"])({
            selector: 'page-login',template:/*ion-inline-start:"E:\APP\mzycApp\src\pages\login\login.html"*/'<!--\n\n  Generated template for the LoginPage page.\n\n\n\n  See http://ionicframework.com/docs/components/#navigation for more info on\n\n  Ionic pages and navigation.\n\n-->\n\n<ion-header>\n\n\n\n <ion-navbar>\n\n   <ion-title></ion-title>\n\n </ion-navbar>\n\n\n\n</ion-header>\n\n <ion-content>\n\n 		<div class="image">\n\n 			<div class="titles">\n\n 				用户登录\n\n 			</div>\n\n		<img src="assets/imgs/login1.png" mode=\'widthFix\' />\n\n		</div>\n\n\n\n        <ion-item class=\'input_item\'>\n\n          <ion-label fixed>手机号</ion-label>\n\n          <!--\n\n          	ngModel 这是双向绑定值\n\n          	loginInfo.UserName 意思是把模型空值绑定到数据库\n\n          -->\n\n          <ion-input type="number" id="username" placeholder="请输入手机号" [(ngModel)]="loginInfo.UserName" (ngModelChange)="eliminate($event)" clearInput></ion-input>\n\n        </ion-item>\n\n        <ion-item class=\'input_item\'>\n\n          <ion-label fixed>密码</ion-label>\n\n          <ion-input type="password"  placeholder="请输入密码"[(ngModel)]="loginInfo.PassWord" ></ion-input>\n\n        </ion-item>\n\n      <div style="text-align: center; margin:auto 7%;">\n\n        <button ion-button full (click)="loginOnSuccess()" class="buttonLogin">\n\n          	 登录\n\n        </button>\n\n      </div>\n\n			<div style=\'text-align:right\' class="font1" (click)="forgetpwd()">忘记密码?</div>\n\n       <div style=\'text-align:center\' class="bottom_link" (click)="register()">新用户注册</div>\n\n    </ion-content>\n\n'/*ion-inline-end:"E:\APP\mzycApp\src\pages\login\login.html"*/,
        }),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1_ionic_angular__["NavController"],
            __WEBPACK_IMPORTED_MODULE_1_ionic_angular__["ViewController"],
            __WEBPACK_IMPORTED_MODULE_2__providers_http_http__["a" /* HttpProvider */],
            __WEBPACK_IMPORTED_MODULE_3__providers_storage_storage__["a" /* StorageProvider */],
            __WEBPACK_IMPORTED_MODULE_4__providers_dialog_dialog__["a" /* DialogProvider */],
            __WEBPACK_IMPORTED_MODULE_1_ionic_angular__["ToastController"],
            __WEBPACK_IMPORTED_MODULE_5__providers_user_info_user_info__["a" /* UserInfoProvider */],
            __WEBPACK_IMPORTED_MODULE_7__providers_service_order_data_service__["a" /* OrderDataService */],
            __WEBPACK_IMPORTED_MODULE_6__providers_service_user_data_service__["a" /* UserDataService */],
            __WEBPACK_IMPORTED_MODULE_8__ionic_native_network__["a" /* Network */],
            __WEBPACK_IMPORTED_MODULE_1_ionic_angular__["ModalController"]])
    ], LoginPage);
    return LoginPage;
}());

var user_info = (function () {
    function user_info() {
    }
    return user_info;
}());

//# sourceMappingURL=login.js.map

/***/ })

});
//# sourceMappingURL=19.js.map